<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>RC3 2016 ~ Goodtime: Misc 150</title>
    <meta name="description" content="This is a misc challenge from RC3 2016. RC3 hosts a CTF every year and have been one of my favorite CTFs simply because it’s a lot easier than the DefCon qua...">
  
    
    <meta name="keywords" content="RC3, Programming">
    

    <meta name="HandheldFriendly" content="True">
    <meta name="robots" content="index,follow">
    <meta name="googlebot" content="index,follow">
	
    <!-- Open Graph data -->

	<meta property="og:title" content="RC3 2016 ~ Goodtime: Misc 150">
	<meta property="og:type" content="article">




<meta property="og:image" content="/images/cover.png">


<meta property="og:site_name" content="Black Magic Exploitation">
<meta property="og:description" content="This is a misc challenge from RC3 2016. RC3 hosts a CTF every year and have been one of my favorite CTFs simply because it’s a lot easier than the DefCon qua...">


<meta property="og:url" content="/blog/ctf/misc/goodtime">


    
	<meta property="article:author" content="http://jwillmer.de/about">
	<link rel="author" href="http://jwillmer.de/about">



<meta property="article:published_time" content="2016-11-20T05:29:33-06:00">



<meta property="article:tag" content="RC3">

<meta property="article:tag" content="Programming">

<!-- End: Open Graph data -->	
	<!-- Twitter data -->
    

<meta name="twitter:card" content="summary">


<meta name="twitter:site" content="@VivieTurtle">



<meta name="twitter:title" content="RC3 2016 ~ Goodtime: Misc 150">




<meta name="twitter:url" content="/blog/ctf/misc/goodtime">


<meta name="twitter:description" content="This is a misc challenge from RC3 2016. RC3 hosts a CTF every year and have been one of my favorite CTFs simply because it’s a lot easier than the DefCon qua...">

<meta name="twitter:image:src" content="/images/cover.png">
<!-- End: Twitter data -->	

    <link href="https://fonts.googleapis.com/css?family=Mrs+Saint+Delafield%7CMerriweather:300italic,700,300,700italic%7COpen+Sans:400,700" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="/css/screen.css">
    <link rel="stylesheet" href="/css/prism.css">
    <link rel="alternate" type="application/rss+xml" title="Black Magic Exploitation" href="/feed.xml">

    <link rel="icon" href="/images/vivi.png" sizes="16x16" type="image/png">
    <link rel="icon" href="/images/vivi.png" sizes="32x32" type="image/png">
    <link rel="icon" href="/images/vivi.png" sizes="48x48" type="image/png">
    <link rel="icon" href="/images/vivi.png" sizes="62x62" type="image/png">
</head>

<body class="home-template">
    <div class="site-wrapper">
        

<header class="main-header detail-page image-bg  has-cover" style=" background-size: cover; background-image: url(/images/cover.png)">
    <h1 class="page-title"><a href="/" title="Black Magic Exploitation">Black Magic Exploitation</a></h1>
    <h2 class="page-description">CTF's, Exploits, and Black Magic</h2>
    <div class="nav">
        <ul>
            <li><a class="page-link" href="/" title="Home">Home</a></li>

            
            

            

            
            

            

            
            

            

            
            

            

            
            

            

            
            

            

            
            

            

            
            

            

            
            

            

            
            

            

            
            <li><a class="page-link" href="/Programming/" title="Programming">Programming</a></li>
            
            

            

            
            <li><a class="page-link" href="/about" title="About">About</a></li>
            
            
        </ul>
    </div>
</header>
        <main class="content" role="main">
    <article class="post single-post" itemscope itemtype="http://schema.org/BlogPosting">

        <header class="post-header short-diver">
            <h1 class="post-title" itemprop="name headline">RC3 2016 ~ Goodtime: Misc 150</h1>
            <section class="post-meta">
                <time datetime="2016-11-20T05:29:33-06:00" itemprop="datePublished">Nov 20, 2016</time> 
                on
                
                <span>RC3</span>
                
                <span>Programming</span>
                
            </section>
        </header>

        <section class="post-content short-diver" itemprop="articleBody">
            <p>This is a misc challenge from RC3 2016. RC3 hosts a CTF every year and have been one of my favorite CTFs simply because it’s a lot easier than the DefCon qualifying CTFs. This challenge in particular was extremely long for a measly 150 points. It’s not very hard - just really annoying and inconsistent.</p>

<h2 id="challenge-details"><strong>Challenge Details</strong></h2>

<pre><code>Goodtime - 150
--------------
The flag is not on the youtube video, the flag on there is someone trying to confuse you. Sorry.
The flag is also longer than normal.
https://www.youtube.com/watch?v=H7HmzwI67ec
nc goodtime.ctf.rc3.club 5866
NOTE: there should be a prompt when you connect. if there isn't it went down so scream at me in IRC until I fix.

author: wumb0
</code></pre>

<p>Like any person would - the first thing I did was view the <a href="https://www.youtube.com/watch?v=H7HmzwI67ec">YouTube</a> video:</p>

<figure>
<iframe width="560" height="315" src="https://www.youtube.com/embed/H7HmzwI67ec" frameborder="0" allowfullscreen=""></iframe>
   <figcaption>Good Time - Owl City &amp; Carly Rae Jepson</figcaption>
</figure>

<p>Obviously no clues here - it’s just a video of Carly Rae Jepson; However, I did notice some guy posted a fake flag in the comments. That gave me a good laugh. Next thing to do was check out the netcat connection.</p>

<figure>
<script height="800" type="text/javascript" src="https://asciinema.org/a/93602.js" id="asciicast-93602" async=""></script>
   <figcaption> nc goodtime.ctf.rc3.club 5866</figcaption>
</figure>

<p>After trying out the netcat server, we noticed the server took longer to respond when we input something in the flag format (RC3-2016-XXXX). Since the title of this challenge was called goodtime - I’m going to assume the exploit is a lineariation attack via response time. In other words, we’ll try to deduce the flag by comparing the response times of different inputs. I would assume the server checks the input - one character at a time. Thus an input of <strong>Apple</strong> have a shorter response time than <strong>RC</strong> simply because the server would check the <strong>A</strong> in <strong>Apple</strong> and stop - meanwhile the server would check <strong>R</strong>, then <strong>C</strong> then look for a <strong>3</strong> (to make RC3) in <strong>RC</strong>. Let’s validate this by creating a script and testing it out.</p>

<p><a href="/assets/rc3/goodtime/manualTime.py">manualTime.py</a></p>

<pre><code class="language-python">#!/usr/bin/env python
import time
import socket
import re
import sys

timer = time.clock if sys.platform == 'win32' else time.time

#host to connect to
host="54.167.134.245"
#the port with whatever u want 
port = 5866
#creating a socket
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

#default values
flag = ""
highestTime = 0
attempt= "RC3-2016-"
allowedChars = "klmnopqrstuvwxyz-ABCDEFGHIJKLMNOPQRSTUVWXYZ"

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
#start timer
start = timer()
#start connecction
s.connect((host, port))
#Recover 2014 bytes of response and print
data2 = s.recv(1024)
print data2
print "Attempting: " + attempt
#Send out flag
s.send(attempt + '\n')
#Read response
data2 = s.recv(1024)
#end timer
print timer()-start
</code></pre>

<p>This script creates a socket and connects to the netcat server via the host and port provided. It then connects to the server using that socket and reads any incoming bytes. After which, we send our attempt on the flag. We wait for a response and print out the response time. This kind of socket scripting is useful when the server response is consistant. Here’s what it looks like in usage.</p>

<figure>
<script height="800" type="text/javascript" src="https://asciinema.org/a/93604.js" id="asciicast-93604" async=""></script>
   <figcaption>python manualTime.py</figcaption>
</figure>

<p>Since now we know it’s a linearization attack on response time, and the flag format is “RC3-2016-XXXXX”, we only need to solve the last line of the flag. To do this, we need to test every single character - like a brute-force attack - and check the reponse time:</p>

<blockquote>
  <p>RC3-2016-a</p>
</blockquote>

<blockquote>
  <p>RC3-2016-b</p>
</blockquote>

<blockquote>
  <p>RC3-2016-c</p>
</blockquote>

<blockquote>
  <p>RC3-2016-d</p>
</blockquote>

<blockquote>
  <p>RC3-2016-e</p>
</blockquote>

<blockquote>
  <p>RC3-2016-f</p>
</blockquote>

<p>Assuming we hit the right character - that response would be be quite larger than the other inputs. Thus we can save the character with the longest response time and assume that’s the next character in the flag. I automated this process in</p>

<p><a href="/assets/rc3/goodtime/goodtime.py">goodtime.py</a></p>

<pre><code class="language-python">#!/usr/bin/env python
import time
import socket
import re
import sys

timer = time.clock if sys.platform == 'win32' else time.time

host="54.167.134.245"
#the port with whatever u want 
port = 5866
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

#default values
flag = "";
highestTime = 0;
attempt= ""
allowedChars = "abcdegfhijklmnopqrstuvwxyz-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ!@#$%^&amp;*()"

for x in range(0,50):
	# Resets highestChar
	highestChar=""
	for x in allowedChars:
		#Creates attempt 1
		attempt = flag + x
		#Create socket
		s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
		#Start timer
		start = timer()
		#Connect to netcat
		s.connect((host, port))
		#Recover response
		data2 = s.recv(1024)
		print data2
		#Send flag
		print "Attempting: " + attempt
		s.send(attempt + '\n')
		#keep this to get the actual response
		data2 = s.recv(1024)
		#End timer
		time1 = timer()-start
		print "Time 1: " + str(time1)
		# print 'time taken ', timer()-start ,' seconds'
		if (timer()-start &gt; highestTime):
			highestTime = timer()-start
			highestChar = x
		s.close()
		#attempt 2
		s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
		start = timer()
		s.connect((host, port))
		data2 = s.recv(1024)
		s.send(attempt + '\n')
		#keep this to get the actual response
		data2 = s.recv(1024)
		time2 = timer()-start
		print "Time 2: " + str(time2)
		# print 'time taken ', timer()-start ,' seconds'
		average = (time1+time2)/2
		print "Average: " + str(average)
		if (average &gt; highestTime):
			highestTime = average
			highestChar = x
		s.close()
	print "Adding [" + highestChar + "] to flag"
	flag = flag + highestChar;
	print "Current Flag: " + flag
</code></pre>

<p>Let’s check it out in use:</p>

<figure>
<script height="800" type="text/javascript" src="https://asciinema.org/a/93590.js" id="asciicast-93590" async=""></script>
   <figcaption>python goodtime.py</figcaption>
</figure>

<p>Combining both the automated and manual script, we were able to get the flag.</p>

<blockquote>
  <p>RC3-2016-itz-alw4yz-a-g00d-t1m1ng-<a href="https://github.com/tt" class="user-mention">@tt</a>@ck</p>
</blockquote>

<p>Let’s confirm</p>

<figure>
<script height="800" type="text/javascript" src="https://asciinema.org/a/93610.js" id="asciicast-93610" async=""></script>
   <figcaption>Confirming the flag</figcaption>
</figure>

<p>The hardest part was due to inconsistency in the netcat connection. Any new characters I received from my script, I had to triple check manually. 9/10 it was just a false positive due to the netcat connection. It might’ve been better if I was connected with a wired connection rather than WIFI. Luckily, it wasn’t so bad to guess some of the flag. When I saw the words <strong>itz-al</strong>, I already knew it was a Carly Rae reference - “It’s always a good time”. I manually input every version of <strong>always</strong> like <strong>alw4ys</strong> and <strong>alw@ys</strong> - one character at a time. Whenever the response time went up - I knew that was the correct character. The most trickiest part was after <strong>g00d-t1m</strong>. I thought I was done because I assumed the flag was <strong>itz alwayz a good time</strong>. I had to bruteforce the second <strong>1</strong> for <strong>t1m1ng</strong>. I had no clue why it was a <strong>1</strong> at the time only to realize an hour later it was <strong>timing</strong> and not <strong>time</strong>. Additionally, the last part of the flag - <strong><a href="https://github.com/tt" class="user-mention">@tt</a>@ck</strong> -  threw me off because I assumed the last word in the flag would be alphanumeric. The last word took me atleast 3 hours because the server kept crashing and each flag I input had a response time of atleast 10 seconds. To brute force the <strong>@</strong> it required all lowercase, uppercase, numbers, and punctuations - 10 seconds a piece. About 10 minutes if I was lucky the server didn’t crash. At last though I was able to get the flag.</p>

        </section>

        <footer class="post-footer"> 
            <div itemprop="author" itemscope itemtype="http://schema.org/Person">

    

    
    

    

</div>
        </footer>

    </article>
</main>

<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="pswp__bg"></div>
    <div class="pswp__scroll-wrap">
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>
<script src="/js/jquery-1.12.0.min.js"></script>
<script src="/js/jquery.fitvids.js"></script>
<script src="/js/prism.js"></script>
<script src="/js/photoswipe.js"></script>
<script src="/js/photoswipe-ui-default.js"></script>
<script src="/js/post.js"></script>        
        <footer class="site-footer">
    <button class="go-to-top"></button>
    <p class="copyright"><a href="" title="Black Magic Exploitation">Black Magic Exploitation</a> © 2018 | <a href="/feed.xml" title="RSS Feed">RSS Feed</a></p>
    <p class="poweredby">powered by <a href="https://jekyllrb.com/" title="Jekyll">Jekyll</a> with the <a href="https://github.com/jwillmer/jekyllDecent" title="jekyllDecent Theme">jekyllDecent</a> theme</p>
</footer>
    </div>
</body>

<script src="/js/global.js"></script>
</html>
